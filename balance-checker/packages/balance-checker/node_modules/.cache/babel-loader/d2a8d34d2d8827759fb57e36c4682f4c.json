{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SigningCosmWasmClient = void 0;\n/* eslint-disable @typescript-eslint/naming-convention */\n\nconst crypto_1 = require(\"@cosmjs/crypto\");\n\nconst encoding_1 = require(\"@cosmjs/encoding\");\n\nconst launchpad_1 = require(\"@cosmjs/launchpad\");\n\nconst math_1 = require(\"@cosmjs/math\");\n\nconst pako_1 = __importDefault(require(\"pako\"));\n\nconst builder_1 = require(\"./builder\");\n\nconst cosmwasmclient_1 = require(\"./cosmwasmclient\");\n\nfunction prepareBuilder(builder) {\n  if (builder === undefined) {\n    return \"\"; // normalization needed by backend\n  } else {\n    if (!builder_1.isValidBuilder(builder)) throw new Error(\"The builder (Docker Hub image with tag) is not valid\");\n    return builder;\n  }\n}\n\nconst defaultGasPrice = launchpad_1.GasPrice.fromString(\"0.025ucosm\");\nconst defaultGasLimits = {\n  upload: 1500000,\n  init: 500000,\n  migrate: 200000,\n  exec: 200000,\n  send: 80000,\n  changeAdmin: 80000\n};\n\nfunction createBroadcastTxErrorMessage(result) {\n  return `Error when broadcasting tx ${result.transactionHash} at height ${result.height}. Code: ${result.code}; Raw log: ${result.rawLog}`;\n}\n\nclass SigningCosmWasmClient extends cosmwasmclient_1.CosmWasmClient {\n  /**\n   * Creates a new client with signing capability to interact with a CosmWasm blockchain. This is the bigger brother of CosmWasmClient.\n   *\n   * This instance does a lot of caching. In order to benefit from that you should try to use one instance\n   * for the lifetime of your application. When switching backends, a new instance must be created.\n   *\n   * @param apiUrl The URL of a Cosmos SDK light client daemon API (sometimes called REST server or REST API)\n   * @param signerAddress The address that will sign transactions using this instance. The `signer` must be able to sign with this address.\n   * @param signer An implementation of OfflineSigner which can provide signatures for transactions, potentially requiring user input.\n   * @param gasPrice The price paid per unit of gas\n   * @param gasLimits Custom overrides for gas limits related to specific transaction types\n   * @param broadcastMode Defines at which point of the transaction processing the broadcastTx method returns\n   */\n  constructor(apiUrl, signerAddress, signer, gasPrice = defaultGasPrice, gasLimits = {}, broadcastMode = launchpad_1.BroadcastMode.Block) {\n    super(apiUrl, broadcastMode);\n    this.anyValidAddress = signerAddress;\n    this.signerAddress = signerAddress;\n    this.signer = signer;\n    this.fees = launchpad_1.buildFeeTable(gasPrice, defaultGasLimits, gasLimits);\n  }\n\n  async getSequence(address) {\n    return super.getSequence(address || this.signerAddress);\n  }\n\n  async getAccount(address) {\n    return super.getAccount(address || this.signerAddress);\n  }\n  /** Uploads code and returns a receipt, including the code ID */\n\n\n  async upload(wasmCode, meta = {}, memo = \"\") {\n    const source = meta.source || \"\";\n    const builder = prepareBuilder(meta.builder);\n    const compressed = pako_1.default.gzip(wasmCode, {\n      level: 9\n    });\n    const storeCodeMsg = {\n      type: \"wasm/MsgStoreCode\",\n      value: {\n        sender: this.signerAddress,\n        wasm_byte_code: encoding_1.toBase64(compressed),\n        source: source,\n        builder: builder\n      }\n    };\n    const result = await this.signAndBroadcast([storeCodeMsg], this.fees.upload, memo);\n\n    if (launchpad_1.isBroadcastTxFailure(result)) {\n      throw new Error(createBroadcastTxErrorMessage(result));\n    }\n\n    const codeIdAttr = launchpad_1.logs.findAttribute(result.logs, \"message\", \"code_id\");\n    return {\n      originalSize: wasmCode.length,\n      originalChecksum: encoding_1.toHex(crypto_1.sha256(wasmCode)),\n      compressedSize: compressed.length,\n      compressedChecksum: encoding_1.toHex(crypto_1.sha256(compressed)),\n      codeId: Number.parseInt(codeIdAttr.value, 10),\n      logs: result.logs,\n      transactionHash: result.transactionHash\n    };\n  }\n\n  async instantiate(codeId, msg, label, options = {}) {\n    const instantiateMsg = {\n      type: \"wasm/MsgInstantiateContract\",\n      value: {\n        sender: this.signerAddress,\n        code_id: new math_1.Uint53(codeId).toString(),\n        label: label,\n        init_msg: msg,\n        init_funds: options.transferAmount || [],\n        admin: options.admin\n      }\n    };\n    const result = await this.signAndBroadcast([instantiateMsg], this.fees.init, options.memo);\n\n    if (launchpad_1.isBroadcastTxFailure(result)) {\n      throw new Error(createBroadcastTxErrorMessage(result));\n    }\n\n    const contractAddressAttr = launchpad_1.logs.findAttribute(result.logs, \"message\", \"contract_address\");\n    return {\n      contractAddress: contractAddressAttr.value,\n      logs: result.logs,\n      transactionHash: result.transactionHash\n    };\n  }\n\n  async updateAdmin(contractAddress, newAdmin, memo = \"\") {\n    const updateAdminMsg = {\n      type: \"wasm/MsgUpdateAdmin\",\n      value: {\n        sender: this.signerAddress,\n        contract: contractAddress,\n        new_admin: newAdmin\n      }\n    };\n    const result = await this.signAndBroadcast([updateAdminMsg], this.fees.changeAdmin, memo);\n\n    if (launchpad_1.isBroadcastTxFailure(result)) {\n      throw new Error(createBroadcastTxErrorMessage(result));\n    }\n\n    return {\n      logs: result.logs,\n      transactionHash: result.transactionHash\n    };\n  }\n\n  async clearAdmin(contractAddress, memo = \"\") {\n    const clearAdminMsg = {\n      type: \"wasm/MsgClearAdmin\",\n      value: {\n        sender: this.signerAddress,\n        contract: contractAddress\n      }\n    };\n    const result = await this.signAndBroadcast([clearAdminMsg], this.fees.changeAdmin, memo);\n\n    if (launchpad_1.isBroadcastTxFailure(result)) {\n      throw new Error(createBroadcastTxErrorMessage(result));\n    }\n\n    return {\n      logs: result.logs,\n      transactionHash: result.transactionHash\n    };\n  }\n\n  async migrate(contractAddress, codeId, migrateMsg, memo = \"\") {\n    const msg = {\n      type: \"wasm/MsgMigrateContract\",\n      value: {\n        sender: this.signerAddress,\n        contract: contractAddress,\n        code_id: new math_1.Uint53(codeId).toString(),\n        msg: migrateMsg\n      }\n    };\n    const result = await this.signAndBroadcast([msg], this.fees.migrate, memo);\n\n    if (launchpad_1.isBroadcastTxFailure(result)) {\n      throw new Error(createBroadcastTxErrorMessage(result));\n    }\n\n    return {\n      logs: result.logs,\n      transactionHash: result.transactionHash\n    };\n  }\n\n  async execute(contractAddress, msg, memo = \"\", funds) {\n    const executeMsg = {\n      type: \"wasm/MsgExecuteContract\",\n      value: {\n        sender: this.signerAddress,\n        contract: contractAddress,\n        msg: msg,\n        sent_funds: funds || []\n      }\n    };\n    const result = await this.signAndBroadcast([executeMsg], this.fees.exec, memo);\n\n    if (launchpad_1.isBroadcastTxFailure(result)) {\n      throw new Error(createBroadcastTxErrorMessage(result));\n    }\n\n    return {\n      logs: result.logs,\n      transactionHash: result.transactionHash\n    };\n  }\n\n  async sendTokens(recipientAddress, amount, memo = \"\") {\n    const sendMsg = {\n      type: \"cosmos-sdk/MsgSend\",\n      value: {\n        from_address: this.signerAddress,\n        to_address: recipientAddress,\n        amount: amount\n      }\n    };\n    return this.signAndBroadcast([sendMsg], this.fees.send, memo);\n  }\n  /**\n   * Gets account number and sequence from the API, creates a sign doc,\n   * creates a single signature, assembles the signed transaction and broadcasts it.\n   */\n\n\n  async signAndBroadcast(msgs, fee, memo = \"\") {\n    const {\n      accountNumber,\n      sequence\n    } = await this.getSequence();\n    const chainId = await this.getChainId();\n    const signDoc = launchpad_1.makeSignDoc(msgs, fee, chainId, memo, accountNumber, sequence);\n    const {\n      signed,\n      signature\n    } = await this.signer.signAmino(this.signerAddress, signDoc);\n    const signedTx = launchpad_1.makeStdTx(signed, signature);\n    return this.broadcastTx(signedTx);\n  }\n\n}\n\nexports.SigningCosmWasmClient = SigningCosmWasmClient;","map":{"version":3,"sources":["../src/signingcosmwasmclient.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SigningCosmWasmClient = void 0;\n/* eslint-disable @typescript-eslint/naming-convention */\nconst crypto_1 = require(\"@cosmjs/crypto\");\nconst encoding_1 = require(\"@cosmjs/encoding\");\nconst launchpad_1 = require(\"@cosmjs/launchpad\");\nconst math_1 = require(\"@cosmjs/math\");\nconst pako_1 = __importDefault(require(\"pako\"));\nconst builder_1 = require(\"./builder\");\nconst cosmwasmclient_1 = require(\"./cosmwasmclient\");\nfunction prepareBuilder(builder) {\n    if (builder === undefined) {\n        return \"\"; // normalization needed by backend\n    }\n    else {\n        if (!builder_1.isValidBuilder(builder))\n            throw new Error(\"The builder (Docker Hub image with tag) is not valid\");\n        return builder;\n    }\n}\nconst defaultGasPrice = launchpad_1.GasPrice.fromString(\"0.025ucosm\");\nconst defaultGasLimits = {\n    upload: 1500000,\n    init: 500000,\n    migrate: 200000,\n    exec: 200000,\n    send: 80000,\n    changeAdmin: 80000,\n};\nfunction createBroadcastTxErrorMessage(result) {\n    return `Error when broadcasting tx ${result.transactionHash} at height ${result.height}. Code: ${result.code}; Raw log: ${result.rawLog}`;\n}\nclass SigningCosmWasmClient extends cosmwasmclient_1.CosmWasmClient {\n    /**\n     * Creates a new client with signing capability to interact with a CosmWasm blockchain. This is the bigger brother of CosmWasmClient.\n     *\n     * This instance does a lot of caching. In order to benefit from that you should try to use one instance\n     * for the lifetime of your application. When switching backends, a new instance must be created.\n     *\n     * @param apiUrl The URL of a Cosmos SDK light client daemon API (sometimes called REST server or REST API)\n     * @param signerAddress The address that will sign transactions using this instance. The `signer` must be able to sign with this address.\n     * @param signer An implementation of OfflineSigner which can provide signatures for transactions, potentially requiring user input.\n     * @param gasPrice The price paid per unit of gas\n     * @param gasLimits Custom overrides for gas limits related to specific transaction types\n     * @param broadcastMode Defines at which point of the transaction processing the broadcastTx method returns\n     */\n    constructor(apiUrl, signerAddress, signer, gasPrice = defaultGasPrice, gasLimits = {}, broadcastMode = launchpad_1.BroadcastMode.Block) {\n        super(apiUrl, broadcastMode);\n        this.anyValidAddress = signerAddress;\n        this.signerAddress = signerAddress;\n        this.signer = signer;\n        this.fees = launchpad_1.buildFeeTable(gasPrice, defaultGasLimits, gasLimits);\n    }\n    async getSequence(address) {\n        return super.getSequence(address || this.signerAddress);\n    }\n    async getAccount(address) {\n        return super.getAccount(address || this.signerAddress);\n    }\n    /** Uploads code and returns a receipt, including the code ID */\n    async upload(wasmCode, meta = {}, memo = \"\") {\n        const source = meta.source || \"\";\n        const builder = prepareBuilder(meta.builder);\n        const compressed = pako_1.default.gzip(wasmCode, { level: 9 });\n        const storeCodeMsg = {\n            type: \"wasm/MsgStoreCode\",\n            value: {\n                sender: this.signerAddress,\n                wasm_byte_code: encoding_1.toBase64(compressed),\n                source: source,\n                builder: builder,\n            },\n        };\n        const result = await this.signAndBroadcast([storeCodeMsg], this.fees.upload, memo);\n        if (launchpad_1.isBroadcastTxFailure(result)) {\n            throw new Error(createBroadcastTxErrorMessage(result));\n        }\n        const codeIdAttr = launchpad_1.logs.findAttribute(result.logs, \"message\", \"code_id\");\n        return {\n            originalSize: wasmCode.length,\n            originalChecksum: encoding_1.toHex(crypto_1.sha256(wasmCode)),\n            compressedSize: compressed.length,\n            compressedChecksum: encoding_1.toHex(crypto_1.sha256(compressed)),\n            codeId: Number.parseInt(codeIdAttr.value, 10),\n            logs: result.logs,\n            transactionHash: result.transactionHash,\n        };\n    }\n    async instantiate(codeId, msg, label, options = {}) {\n        const instantiateMsg = {\n            type: \"wasm/MsgInstantiateContract\",\n            value: {\n                sender: this.signerAddress,\n                code_id: new math_1.Uint53(codeId).toString(),\n                label: label,\n                init_msg: msg,\n                init_funds: options.transferAmount || [],\n                admin: options.admin,\n            },\n        };\n        const result = await this.signAndBroadcast([instantiateMsg], this.fees.init, options.memo);\n        if (launchpad_1.isBroadcastTxFailure(result)) {\n            throw new Error(createBroadcastTxErrorMessage(result));\n        }\n        const contractAddressAttr = launchpad_1.logs.findAttribute(result.logs, \"message\", \"contract_address\");\n        return {\n            contractAddress: contractAddressAttr.value,\n            logs: result.logs,\n            transactionHash: result.transactionHash,\n        };\n    }\n    async updateAdmin(contractAddress, newAdmin, memo = \"\") {\n        const updateAdminMsg = {\n            type: \"wasm/MsgUpdateAdmin\",\n            value: {\n                sender: this.signerAddress,\n                contract: contractAddress,\n                new_admin: newAdmin,\n            },\n        };\n        const result = await this.signAndBroadcast([updateAdminMsg], this.fees.changeAdmin, memo);\n        if (launchpad_1.isBroadcastTxFailure(result)) {\n            throw new Error(createBroadcastTxErrorMessage(result));\n        }\n        return {\n            logs: result.logs,\n            transactionHash: result.transactionHash,\n        };\n    }\n    async clearAdmin(contractAddress, memo = \"\") {\n        const clearAdminMsg = {\n            type: \"wasm/MsgClearAdmin\",\n            value: {\n                sender: this.signerAddress,\n                contract: contractAddress,\n            },\n        };\n        const result = await this.signAndBroadcast([clearAdminMsg], this.fees.changeAdmin, memo);\n        if (launchpad_1.isBroadcastTxFailure(result)) {\n            throw new Error(createBroadcastTxErrorMessage(result));\n        }\n        return {\n            logs: result.logs,\n            transactionHash: result.transactionHash,\n        };\n    }\n    async migrate(contractAddress, codeId, migrateMsg, memo = \"\") {\n        const msg = {\n            type: \"wasm/MsgMigrateContract\",\n            value: {\n                sender: this.signerAddress,\n                contract: contractAddress,\n                code_id: new math_1.Uint53(codeId).toString(),\n                msg: migrateMsg,\n            },\n        };\n        const result = await this.signAndBroadcast([msg], this.fees.migrate, memo);\n        if (launchpad_1.isBroadcastTxFailure(result)) {\n            throw new Error(createBroadcastTxErrorMessage(result));\n        }\n        return {\n            logs: result.logs,\n            transactionHash: result.transactionHash,\n        };\n    }\n    async execute(contractAddress, msg, memo = \"\", funds) {\n        const executeMsg = {\n            type: \"wasm/MsgExecuteContract\",\n            value: {\n                sender: this.signerAddress,\n                contract: contractAddress,\n                msg: msg,\n                sent_funds: funds || [],\n            },\n        };\n        const result = await this.signAndBroadcast([executeMsg], this.fees.exec, memo);\n        if (launchpad_1.isBroadcastTxFailure(result)) {\n            throw new Error(createBroadcastTxErrorMessage(result));\n        }\n        return {\n            logs: result.logs,\n            transactionHash: result.transactionHash,\n        };\n    }\n    async sendTokens(recipientAddress, amount, memo = \"\") {\n        const sendMsg = {\n            type: \"cosmos-sdk/MsgSend\",\n            value: {\n                from_address: this.signerAddress,\n                to_address: recipientAddress,\n                amount: amount,\n            },\n        };\n        return this.signAndBroadcast([sendMsg], this.fees.send, memo);\n    }\n    /**\n     * Gets account number and sequence from the API, creates a sign doc,\n     * creates a single signature, assembles the signed transaction and broadcasts it.\n     */\n    async signAndBroadcast(msgs, fee, memo = \"\") {\n        const { accountNumber, sequence } = await this.getSequence();\n        const chainId = await this.getChainId();\n        const signDoc = launchpad_1.makeSignDoc(msgs, fee, chainId, memo, accountNumber, sequence);\n        const { signed, signature } = await this.signer.signAmino(this.signerAddress, signDoc);\n        const signedTx = launchpad_1.makeStdTx(signed, signature);\n        return this.broadcastTx(signedTx);\n    }\n}\nexports.SigningCosmWasmClient = SigningCosmWasmClient;\n//# sourceMappingURL=signingcosmwasmclient.js.map"]},"metadata":{},"sourceType":"script"}