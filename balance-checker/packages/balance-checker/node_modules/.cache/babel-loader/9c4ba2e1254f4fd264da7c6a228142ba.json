{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nvar _ripemd = _interopRequireDefault(require(\"ripemd160\"));\n\nvar _bech = _interopRequireDefault(require(\"bech32\"));\n\nvar _helperV = require(\"./helperV1\");\n\nvar _helperV2 = require(\"./helperV2\");\n\nvar _common = require(\"./common\");\n/** ******************************************************************************\n *  (c) 2019 ZondaX GmbH\n *  (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ******************************************************************************* */\n\n\nvar CosmosApp = /*#__PURE__*/function () {\n  function CosmosApp(transport) {\n    var scrambleKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _common.APP_KEY;\n    (0, _classCallCheck2.default)(this, CosmosApp);\n\n    if (!transport) {\n      throw new Error(\"Transport has not been defined\");\n    }\n\n    this.transport = transport;\n    transport.decorateAppAPIMethods(this, [\"getVersion\", \"sign\", \"getAddressAndPubKey\", \"appInfo\", \"deviceInfo\", \"getBech32FromPK\"], scrambleKey);\n  }\n\n  (0, _createClass2.default)(CosmosApp, [{\n    key: \"serializePath\",\n    value: function () {\n      var _serializePath = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(path) {\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return (0, _common.getVersion)(this.transport);\n\n              case 2:\n                this.versionResponse = _context.sent;\n\n                if (!(this.versionResponse.return_code !== _common.ERROR_CODE.NoError)) {\n                  _context.next = 5;\n                  break;\n                }\n\n                throw this.versionResponse;\n\n              case 5:\n                _context.t0 = this.versionResponse.major;\n                _context.next = _context.t0 === 1 ? 8 : _context.t0 === 2 ? 9 : 10;\n                break;\n\n              case 8:\n                return _context.abrupt(\"return\", (0, _helperV.serializePathv1)(path));\n\n              case 9:\n                return _context.abrupt(\"return\", (0, _helperV2.serializePathv2)(path));\n\n              case 10:\n                return _context.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function serializePath(_x) {\n        return _serializePath.apply(this, arguments);\n      }\n\n      return serializePath;\n    }()\n  }, {\n    key: \"signGetChunks\",\n    value: function () {\n      var _signGetChunks = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(path, message) {\n        var serializedPath, chunks, buffer, i, end;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.serializePath(path);\n\n              case 2:\n                serializedPath = _context2.sent;\n                chunks = [];\n                chunks.push(serializedPath);\n                buffer = Buffer.from(message);\n\n                for (i = 0; i < buffer.length; i += _common.CHUNK_SIZE) {\n                  end = i + _common.CHUNK_SIZE;\n\n                  if (i > buffer.length) {\n                    end = buffer.length;\n                  }\n\n                  chunks.push(buffer.slice(i, end));\n                }\n\n                return _context2.abrupt(\"return\", chunks);\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function signGetChunks(_x2, _x3) {\n        return _signGetChunks.apply(this, arguments);\n      }\n\n      return signGetChunks;\n    }()\n  }, {\n    key: \"getVersion\",\n    value: function () {\n      var _getVersion2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return (0, _common.getVersion)(this.transport);\n\n              case 3:\n                this.versionResponse = _context3.sent;\n                return _context3.abrupt(\"return\", this.versionResponse);\n\n              case 7:\n                _context3.prev = 7;\n                _context3.t0 = _context3[\"catch\"](0);\n                return _context3.abrupt(\"return\", (0, _common.processErrorResponse)(_context3.t0));\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 7]]);\n      }));\n\n      function getVersion() {\n        return _getVersion2.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: \"appInfo\",\n    value: function () {\n      var _appInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4() {\n        return _regenerator.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this.transport.send(0xb0, 0x01, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var result = {};\n                  var appName = \"err\";\n                  var appVersion = \"err\";\n                  var flagLen = 0;\n                  var flagsValue = 0;\n\n                  if (response[0] !== 1) {\n                    // Ledger responds with format ID 1. There is no spec for any format != 1\n                    result.error_message = \"response format ID not recognized\";\n                    result.return_code = 0x9001;\n                  } else {\n                    var appNameLen = response[1];\n                    appName = response.slice(2, 2 + appNameLen).toString(\"ascii\");\n                    var idx = 2 + appNameLen;\n                    var appVersionLen = response[idx];\n                    idx += 1;\n                    appVersion = response.slice(idx, idx + appVersionLen).toString(\"ascii\");\n                    idx += appVersionLen;\n                    var appFlagsLen = response[idx];\n                    idx += 1;\n                    flagLen = appFlagsLen;\n                    flagsValue = response[idx];\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    appName: appName,\n                    appVersion: appVersion,\n                    flagLen: flagLen,\n                    flagsValue: flagsValue,\n                    // eslint-disable-next-line no-bitwise\n                    flag_recovery: (flagsValue & 1) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_signed_mcu_code: (flagsValue & 2) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_onboarded: (flagsValue & 4) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_pin_validated: (flagsValue & 128) !== 0\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function appInfo() {\n        return _appInfo.apply(this, arguments);\n      }\n\n      return appInfo;\n    }()\n  }, {\n    key: \"deviceInfo\",\n    value: function () {\n      var _deviceInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n        return _regenerator.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt(\"return\", this.transport.send(0xe0, 0x01, 0, 0, Buffer.from([]), [_common.ERROR_CODE.NoError, 0x6e00]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n\n                  if (returnCode === 0x6e00) {\n                    return {\n                      return_code: returnCode,\n                      error_message: \"This command is only available in the Dashboard\"\n                    };\n                  }\n\n                  var targetId = response.slice(0, 4).toString(\"hex\");\n                  var pos = 4;\n                  var secureElementVersionLen = response[pos];\n                  pos += 1;\n                  var seVersion = response.slice(pos, pos + secureElementVersionLen).toString();\n                  pos += secureElementVersionLen;\n                  var flagsLen = response[pos];\n                  pos += 1;\n                  var flag = response.slice(pos, pos + flagsLen).toString(\"hex\");\n                  pos += flagsLen;\n                  var mcuVersionLen = response[pos];\n                  pos += 1; // Patch issue in mcu version\n\n                  var tmp = response.slice(pos, pos + mcuVersionLen);\n\n                  if (tmp[mcuVersionLen - 1] === 0) {\n                    tmp = response.slice(pos, pos + mcuVersionLen - 1);\n                  }\n\n                  var mcuVersion = tmp.toString();\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    targetId: targetId,\n                    seVersion: seVersion,\n                    flag: flag,\n                    mcuVersion: mcuVersion\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function deviceInfo() {\n        return _deviceInfo.apply(this, arguments);\n      }\n\n      return deviceInfo;\n    }()\n  }, {\n    key: \"publicKey\",\n    value: function () {\n      var _publicKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(path) {\n        var serializedPath, data;\n        return _regenerator.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return this.serializePath(path);\n\n              case 3:\n                serializedPath = _context6.sent;\n                _context6.t0 = this.versionResponse.major;\n                _context6.next = _context6.t0 === 1 ? 7 : _context6.t0 === 2 ? 8 : 10;\n                break;\n\n              case 7:\n                return _context6.abrupt(\"return\", (0, _helperV.publicKeyv1)(this, serializedPath));\n\n              case 8:\n                data = Buffer.concat([CosmosApp.serializeHRP(\"cosmos\"), serializedPath]);\n                return _context6.abrupt(\"return\", (0, _helperV2.publicKeyv2)(this, data));\n\n              case 10:\n                return _context6.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 11:\n                _context6.next = 16;\n                break;\n\n              case 13:\n                _context6.prev = 13;\n                _context6.t1 = _context6[\"catch\"](0);\n                return _context6.abrupt(\"return\", (0, _common.processErrorResponse)(_context6.t1));\n\n              case 16:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 13]]);\n      }));\n\n      function publicKey(_x4) {\n        return _publicKey.apply(this, arguments);\n      }\n\n      return publicKey;\n    }()\n  }, {\n    key: \"getAddressAndPubKey\",\n    value: function () {\n      var _getAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7(path, hrp) {\n        var _this = this;\n\n        return _regenerator.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.prev = 0;\n                return _context7.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.ONLY_RETRIEVE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n\n              case 4:\n                _context7.prev = 4;\n                _context7.t0 = _context7[\"catch\"](0);\n                return _context7.abrupt(\"return\", (0, _common.processErrorResponse)(_context7.t0));\n\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this, [[0, 4]]);\n      }));\n\n      function getAddressAndPubKey(_x5, _x6) {\n        return _getAddressAndPubKey.apply(this, arguments);\n      }\n\n      return getAddressAndPubKey;\n    }()\n  }, {\n    key: \"showAddressAndPubKey\",\n    value: function () {\n      var _showAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8(path, hrp) {\n        var _this2 = this;\n\n        return _regenerator.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.prev = 0;\n                return _context8.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this2.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.SHOW_ADDRESS_IN_DEVICE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n\n              case 4:\n                _context8.prev = 4;\n                _context8.t0 = _context8[\"catch\"](0);\n                return _context8.abrupt(\"return\", (0, _common.processErrorResponse)(_context8.t0));\n\n              case 7:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[0, 4]]);\n      }));\n\n      function showAddressAndPubKey(_x7, _x8) {\n        return _showAddressAndPubKey.apply(this, arguments);\n      }\n\n      return showAddressAndPubKey;\n    }()\n  }, {\n    key: \"signSendChunk\",\n    value: function () {\n      var _signSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee9(chunkIdx, chunkNum, chunk) {\n        return _regenerator.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.t0 = this.versionResponse.major;\n                _context9.next = _context9.t0 === 1 ? 3 : _context9.t0 === 2 ? 4 : 5;\n                break;\n\n              case 3:\n                return _context9.abrupt(\"return\", (0, _helperV.signSendChunkv1)(this, chunkIdx, chunkNum, chunk));\n\n              case 4:\n                return _context9.abrupt(\"return\", (0, _helperV2.signSendChunkv2)(this, chunkIdx, chunkNum, chunk));\n\n              case 5:\n                return _context9.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 6:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function signSendChunk(_x9, _x10, _x11) {\n        return _signSendChunk.apply(this, arguments);\n      }\n\n      return signSendChunk;\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee11(path, message) {\n        var _this3 = this;\n\n        return _regenerator.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                return _context11.abrupt(\"return\", this.signGetChunks(path, message).then(function (chunks) {\n                  return _this3.signSendChunk(1, chunks.length, chunks[0], [_common.ERROR_CODE.NoError]).then( /*#__PURE__*/function () {\n                    var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee10(response) {\n                      var result, i;\n                      return _regenerator.default.wrap(function _callee10$(_context10) {\n                        while (1) {\n                          switch (_context10.prev = _context10.next) {\n                            case 0:\n                              result = {\n                                return_code: response.return_code,\n                                error_message: response.error_message,\n                                signature: null\n                              };\n                              i = 1;\n\n                            case 2:\n                              if (!(i < chunks.length)) {\n                                _context10.next = 11;\n                                break;\n                              }\n\n                              _context10.next = 5;\n                              return _this3.signSendChunk(1 + i, chunks.length, chunks[i]);\n\n                            case 5:\n                              result = _context10.sent;\n\n                              if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                                _context10.next = 8;\n                                break;\n                              }\n\n                              return _context10.abrupt(\"break\", 11);\n\n                            case 8:\n                              i += 1;\n                              _context10.next = 2;\n                              break;\n\n                            case 11:\n                              return _context10.abrupt(\"return\", {\n                                return_code: result.return_code,\n                                error_message: result.error_message,\n                                // ///\n                                signature: result.signature\n                              });\n\n                            case 12:\n                            case \"end\":\n                              return _context10.stop();\n                          }\n                        }\n                      }, _callee10);\n                    }));\n\n                    return function (_x14) {\n                      return _ref.apply(this, arguments);\n                    };\n                  }(), _common.processErrorResponse);\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function sign(_x12, _x13) {\n        return _sign.apply(this, arguments);\n      }\n\n      return sign;\n    }()\n  }], [{\n    key: \"serializeHRP\",\n    value: function serializeHRP(hrp) {\n      if (hrp == null || hrp.length < 3 || hrp.length > 83) {\n        throw new Error(\"Invalid HRP\");\n      }\n\n      var buf = Buffer.alloc(1 + hrp.length);\n      buf.writeUInt8(hrp.length, 0);\n      buf.write(hrp, 1);\n      return buf;\n    }\n  }, {\n    key: \"getBech32FromPK\",\n    value: function getBech32FromPK(hrp, pk) {\n      if (pk.length !== 33) {\n        throw new Error(\"expected compressed public key [31 bytes]\");\n      }\n\n      var hashSha256 = _crypto.default.createHash(\"sha256\").update(pk).digest();\n\n      var hashRip = new _ripemd.default().update(hashSha256).digest();\n      return _bech.default.encode(hrp, _bech.default.toWords(hashRip));\n    }\n  }]);\n  return CosmosApp;\n}();\n\nexports.default = CosmosApp;","map":{"version":3,"sources":["/Users/makand/cosmwasm/dApps/node_modules/ledger-cosmos-js/dist/index.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_regenerator","_asyncToGenerator2","_classCallCheck2","_createClass2","_crypto","_ripemd","_bech","_helperV","_helperV2","_common","CosmosApp","transport","scrambleKey","arguments","length","undefined","APP_KEY","Error","decorateAppAPIMethods","key","_serializePath","mark","_callee","path","wrap","_callee$","_context","prev","next","getVersion","versionResponse","sent","return_code","ERROR_CODE","NoError","t0","major","abrupt","serializePathv1","serializePathv2","error_message","stop","serializePath","_x","apply","_signGetChunks","_callee2","message","serializedPath","chunks","buffer","i","end","_callee2$","_context2","push","Buffer","from","CHUNK_SIZE","slice","signGetChunks","_x2","_x3","_getVersion2","_callee3","_callee3$","_context3","processErrorResponse","_appInfo","_callee4","_callee4$","_context4","send","then","response","errorCodeData","returnCode","result","appName","appVersion","flagLen","flagsValue","appNameLen","toString","idx","appVersionLen","appFlagsLen","errorCodeToString","flag_recovery","flag_signed_mcu_code","flag_onboarded","flag_pin_validated","appInfo","_deviceInfo","_callee5","_callee5$","_context5","targetId","pos","secureElementVersionLen","seVersion","flagsLen","flag","mcuVersionLen","tmp","mcuVersion","deviceInfo","_publicKey","_callee6","data","_callee6$","_context6","publicKeyv1","concat","serializeHRP","publicKeyv2","t1","publicKey","_x4","_getAddressAndPubKey","_callee7","hrp","_this","_callee7$","_context7","CLA","INS","GET_ADDR_SECP256K1","P1_VALUES","ONLY_RETRIEVE","compressedPk","bech32Address","bech32_address","compressed_pk","catch","err","getAddressAndPubKey","_x5","_x6","_showAddressAndPubKey","_callee8","_this2","_callee8$","_context8","SHOW_ADDRESS_IN_DEVICE","showAddressAndPubKey","_x7","_x8","_signSendChunk","_callee9","chunkIdx","chunkNum","chunk","_callee9$","_context9","signSendChunkv1","signSendChunkv2","signSendChunk","_x9","_x10","_x11","_sign","_callee11","_this3","_callee11$","_context11","_ref","_callee10","_callee10$","_context10","signature","_x14","sign","_x12","_x13","buf","alloc","writeUInt8","write","getBech32FromPK","pk","hashSha256","createHash","update","digest","hashRip","encode","toWords"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,8CAAD,CAApC;;AAEAC,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,OAAR,GAAkB,KAAK,CAAvB;;AAEA,IAAIC,YAAY,GAAGP,sBAAsB,CAACC,OAAO,CAAC,4BAAD,CAAR,CAAzC;;AAEA,IAAIO,kBAAkB,GAAGR,sBAAsB,CAACC,OAAO,CAAC,yCAAD,CAAR,CAA/C;;AAEA,IAAIQ,gBAAgB,GAAGT,sBAAsB,CAACC,OAAO,CAAC,uCAAD,CAAR,CAA7C;;AAEA,IAAIS,aAAa,GAAGV,sBAAsB,CAACC,OAAO,CAAC,oCAAD,CAAR,CAA1C;;AAEA,IAAIU,OAAO,GAAGX,sBAAsB,CAACC,OAAO,CAAC,QAAD,CAAR,CAApC;;AAEA,IAAIW,OAAO,GAAGZ,sBAAsB,CAACC,OAAO,CAAC,WAAD,CAAR,CAApC;;AAEA,IAAIY,KAAK,GAAGb,sBAAsB,CAACC,OAAO,CAAC,QAAD,CAAR,CAAlC;;AAEA,IAAIa,QAAQ,GAAGb,OAAO,CAAC,YAAD,CAAtB;;AAEA,IAAIc,SAAS,GAAGd,OAAO,CAAC,YAAD,CAAvB;;AAEA,IAAIe,OAAO,GAAGf,OAAO,CAAC,UAAD,CAArB;AAEA;;;;;;;;;;;;;;;;;;AAgBA,IAAIgB,SAAS,GAAG,aAAa,YAAY;AACvC,WAASA,SAAT,CAAmBC,SAAnB,EAA8B;AAC5B,QAAIC,WAAW,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoEJ,OAAO,CAACO,OAA9F;AACA,KAAC,GAAGd,gBAAgB,CAACH,OAArB,EAA8B,IAA9B,EAAoCW,SAApC;;AAEA,QAAI,CAACC,SAAL,EAAgB;AACd,YAAM,IAAIM,KAAJ,CAAU,gCAAV,CAAN;AACD;;AAED,SAAKN,SAAL,GAAiBA,SAAjB;AACAA,IAAAA,SAAS,CAACO,qBAAV,CAAgC,IAAhC,EAAsC,CAAC,YAAD,EAAe,MAAf,EAAuB,qBAAvB,EAA8C,SAA9C,EAAyD,YAAzD,EAAuE,iBAAvE,CAAtC,EAAiIN,WAAjI;AACD;;AAED,GAAC,GAAGT,aAAa,CAACJ,OAAlB,EAA2BW,SAA3B,EAAsC,CAAC;AACrCS,IAAAA,GAAG,EAAE,eADgC;AAErCrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIsB,cAAc,GAAG,CAAC,GAAGnB,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AAClH,eAAOvB,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASC,QAAT,CAAkBC,QAAlB,EAA4B;AAC3D,iBAAO,CAAP,EAAU;AACR,oBAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACE,IAAjC;AACE,mBAAK,CAAL;AACEF,gBAAAA,QAAQ,CAACE,IAAT,GAAgB,CAAhB;AACA,uBAAO,CAAC,GAAGnB,OAAO,CAACoB,UAAZ,EAAwB,KAAKlB,SAA7B,CAAP;;AAEF,mBAAK,CAAL;AACE,qBAAKmB,eAAL,GAAuBJ,QAAQ,CAACK,IAAhC;;AAEA,oBAAI,EAAE,KAAKD,eAAL,CAAqBE,WAArB,KAAqCvB,OAAO,CAACwB,UAAR,CAAmBC,OAA1D,CAAJ,EAAwE;AACtER,kBAAAA,QAAQ,CAACE,IAAT,GAAgB,CAAhB;AACA;AACD;;AAED,sBAAM,KAAKE,eAAX;;AAEF,mBAAK,CAAL;AACEJ,gBAAAA,QAAQ,CAACS,EAAT,GAAc,KAAKL,eAAL,CAAqBM,KAAnC;AACAV,gBAAAA,QAAQ,CAACE,IAAT,GAAgBF,QAAQ,CAACS,EAAT,KAAgB,CAAhB,GAAoB,CAApB,GAAwBT,QAAQ,CAACS,EAAT,KAAgB,CAAhB,GAAoB,CAApB,GAAwB,EAAhE;AACA;;AAEF,mBAAK,CAAL;AACE,uBAAOT,QAAQ,CAACW,MAAT,CAAgB,QAAhB,EAA0B,CAAC,GAAG9B,QAAQ,CAAC+B,eAAb,EAA8Bf,IAA9B,CAA1B,CAAP;;AAEF,mBAAK,CAAL;AACE,uBAAOG,QAAQ,CAACW,MAAT,CAAgB,QAAhB,EAA0B,CAAC,GAAG7B,SAAS,CAAC+B,eAAd,EAA+BhB,IAA/B,CAA1B,CAAP;;AAEF,mBAAK,EAAL;AACE,uBAAOG,QAAQ,CAACW,MAAT,CAAgB,QAAhB,EAA0B;AAC/BL,kBAAAA,WAAW,EAAE,MADkB;AAE/BQ,kBAAAA,aAAa,EAAE;AAFgB,iBAA1B,CAAP;;AAKF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOd,QAAQ,CAACe,IAAT,EAAP;AAlCJ;AAoCD;AACF,SAvCM,EAuCJnB,OAvCI,EAuCK,IAvCL,CAAP;AAwCD,OAzCkE,CAA9C,CAArB;;AA2CA,eAASoB,aAAT,CAAuBC,EAAvB,EAA2B;AACzB,eAAOvB,cAAc,CAACwB,KAAf,CAAqB,IAArB,EAA2B/B,SAA3B,CAAP;AACD;;AAED,aAAO6B,aAAP;AACD,KAjDM;AAF8B,GAAD,EAoDnC;AACDvB,IAAAA,GAAG,EAAE,eADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI+C,cAAc,GAAG,CAAC,GAAG5C,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASyB,QAAT,CAAkBvB,IAAlB,EAAwBwB,OAAxB,EAAiC;AAC5H,YAAIC,cAAJ,EAAoBC,MAApB,EAA4BC,MAA5B,EAAoCC,CAApC,EAAuCC,GAAvC;AACA,eAAOpD,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAAS6B,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAAC3B,IAAV,GAAiB2B,SAAS,CAAC1B,IAAnC;AACE,mBAAK,CAAL;AACE0B,gBAAAA,SAAS,CAAC1B,IAAV,GAAiB,CAAjB;AACA,uBAAO,KAAKc,aAAL,CAAmBnB,IAAnB,CAAP;;AAEF,mBAAK,CAAL;AACEyB,gBAAAA,cAAc,GAAGM,SAAS,CAACvB,IAA3B;AACAkB,gBAAAA,MAAM,GAAG,EAAT;AACAA,gBAAAA,MAAM,CAACM,IAAP,CAAYP,cAAZ;AACAE,gBAAAA,MAAM,GAAGM,MAAM,CAACC,IAAP,CAAYV,OAAZ,CAAT;;AAEA,qBAAKI,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGD,MAAM,CAACpC,MAAvB,EAA+BqC,CAAC,IAAI1C,OAAO,CAACiD,UAA5C,EAAwD;AACtDN,kBAAAA,GAAG,GAAGD,CAAC,GAAG1C,OAAO,CAACiD,UAAlB;;AAEA,sBAAIP,CAAC,GAAGD,MAAM,CAACpC,MAAf,EAAuB;AACrBsC,oBAAAA,GAAG,GAAGF,MAAM,CAACpC,MAAb;AACD;;AAEDmC,kBAAAA,MAAM,CAACM,IAAP,CAAYL,MAAM,CAACS,KAAP,CAAaR,CAAb,EAAgBC,GAAhB,CAAZ;AACD;;AAED,uBAAOE,SAAS,CAACjB,MAAV,CAAiB,QAAjB,EAA2BY,MAA3B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOK,SAAS,CAACb,IAAV,EAAP;AAzBJ;AA2BD;AACF,SA9BM,EA8BJK,QA9BI,EA8BM,IA9BN,CAAP;AA+BD,OAjCkE,CAA9C,CAArB;;AAmCA,eAASc,aAAT,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC/B,eAAOjB,cAAc,CAACD,KAAf,CAAqB,IAArB,EAA2B/B,SAA3B,CAAP;AACD;;AAED,aAAO+C,aAAP;AACD,KAzCM;AAFN,GApDmC,EAgGnC;AACDzC,IAAAA,GAAG,EAAE,YADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIiE,YAAY,GAAG,CAAC,GAAG9D,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAAS2C,QAAT,GAAoB;AAC7G,eAAOhE,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASyC,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACvC,IAAV,GAAiBuC,SAAS,CAACtC,IAAnC;AACE,mBAAK,CAAL;AACEsC,gBAAAA,SAAS,CAACvC,IAAV,GAAiB,CAAjB;AACAuC,gBAAAA,SAAS,CAACtC,IAAV,GAAiB,CAAjB;AACA,uBAAO,CAAC,GAAGnB,OAAO,CAACoB,UAAZ,EAAwB,KAAKlB,SAA7B,CAAP;;AAEF,mBAAK,CAAL;AACE,qBAAKmB,eAAL,GAAuBoC,SAAS,CAACnC,IAAjC;AACA,uBAAOmC,SAAS,CAAC7B,MAAV,CAAiB,QAAjB,EAA2B,KAAKP,eAAhC,CAAP;;AAEF,mBAAK,CAAL;AACEoC,gBAAAA,SAAS,CAACvC,IAAV,GAAiB,CAAjB;AACAuC,gBAAAA,SAAS,CAAC/B,EAAV,GAAe+B,SAAS,CAAC,OAAD,CAAT,CAAmB,CAAnB,CAAf;AACA,uBAAOA,SAAS,CAAC7B,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG5B,OAAO,CAAC0D,oBAAZ,EAAkCD,SAAS,CAAC/B,EAA5C,CAA3B,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAO+B,SAAS,CAACzB,IAAV,EAAP;AAjBJ;AAmBD;AACF,SAtBM,EAsBJuB,QAtBI,EAsBM,IAtBN,EAsBY,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,CAtBZ,CAAP;AAuBD,OAxBgE,CAA9C,CAAnB;;AA0BA,eAASnC,UAAT,GAAsB;AACpB,eAAOkC,YAAY,CAACnB,KAAb,CAAmB,IAAnB,EAAyB/B,SAAzB,CAAP;AACD;;AAED,aAAOgB,UAAP;AACD,KAhCM;AAFN,GAhGmC,EAmInC;AACDV,IAAAA,GAAG,EAAE,SADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIsE,QAAQ,GAAG,CAAC,GAAGnE,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASgD,QAAT,GAAoB;AACzG,eAAOrE,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAAS8C,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAAC5C,IAAV,GAAiB4C,SAAS,CAAC3C,IAAnC;AACE,mBAAK,CAAL;AACE,uBAAO2C,SAAS,CAAClC,MAAV,CAAiB,QAAjB,EAA2B,KAAK1B,SAAL,CAAe6D,IAAf,CAAoB,IAApB,EAA0B,IAA1B,EAAgC,CAAhC,EAAmC,CAAnC,EAAsCC,IAAtC,CAA2C,UAAUC,QAAV,EAAoB;AAC/F,sBAAIC,aAAa,GAAGD,QAAQ,CAACf,KAAT,CAAe,CAAC,CAAhB,CAApB;AACA,sBAAIiB,UAAU,GAAGD,aAAa,CAAC,CAAD,CAAb,GAAmB,GAAnB,GAAyBA,aAAa,CAAC,CAAD,CAAvD;AACA,sBAAIE,MAAM,GAAG,EAAb;AACA,sBAAIC,OAAO,GAAG,KAAd;AACA,sBAAIC,UAAU,GAAG,KAAjB;AACA,sBAAIC,OAAO,GAAG,CAAd;AACA,sBAAIC,UAAU,GAAG,CAAjB;;AAEA,sBAAIP,QAAQ,CAAC,CAAD,CAAR,KAAgB,CAApB,EAAuB;AACrB;AACAG,oBAAAA,MAAM,CAACrC,aAAP,GAAuB,mCAAvB;AACAqC,oBAAAA,MAAM,CAAC7C,WAAP,GAAqB,MAArB;AACD,mBAJD,MAIO;AACL,wBAAIkD,UAAU,GAAGR,QAAQ,CAAC,CAAD,CAAzB;AACAI,oBAAAA,OAAO,GAAGJ,QAAQ,CAACf,KAAT,CAAe,CAAf,EAAkB,IAAIuB,UAAtB,EAAkCC,QAAlC,CAA2C,OAA3C,CAAV;AACA,wBAAIC,GAAG,GAAG,IAAIF,UAAd;AACA,wBAAIG,aAAa,GAAGX,QAAQ,CAACU,GAAD,CAA5B;AACAA,oBAAAA,GAAG,IAAI,CAAP;AACAL,oBAAAA,UAAU,GAAGL,QAAQ,CAACf,KAAT,CAAeyB,GAAf,EAAoBA,GAAG,GAAGC,aAA1B,EAAyCF,QAAzC,CAAkD,OAAlD,CAAb;AACAC,oBAAAA,GAAG,IAAIC,aAAP;AACA,wBAAIC,WAAW,GAAGZ,QAAQ,CAACU,GAAD,CAA1B;AACAA,oBAAAA,GAAG,IAAI,CAAP;AACAJ,oBAAAA,OAAO,GAAGM,WAAV;AACAL,oBAAAA,UAAU,GAAGP,QAAQ,CAACU,GAAD,CAArB;AACD;;AAED,yBAAO;AACLpD,oBAAAA,WAAW,EAAE4C,UADR;AAELpC,oBAAAA,aAAa,EAAE,CAAC,GAAG/B,OAAO,CAAC8E,iBAAZ,EAA+BX,UAA/B,CAFV;AAGL;AACAE,oBAAAA,OAAO,EAAEA,OAJJ;AAKLC,oBAAAA,UAAU,EAAEA,UALP;AAMLC,oBAAAA,OAAO,EAAEA,OANJ;AAOLC,oBAAAA,UAAU,EAAEA,UAPP;AAQL;AACAO,oBAAAA,aAAa,EAAE,CAACP,UAAU,GAAG,CAAd,MAAqB,CAT/B;AAUL;AACAQ,oBAAAA,oBAAoB,EAAE,CAACR,UAAU,GAAG,CAAd,MAAqB,CAXtC;AAYL;AACAS,oBAAAA,cAAc,EAAE,CAACT,UAAU,GAAG,CAAd,MAAqB,CAbhC;AAcL;AACAU,oBAAAA,kBAAkB,EAAE,CAACV,UAAU,GAAG,GAAd,MAAuB;AAftC,mBAAP;AAiBD,iBA5CiC,EA4C/BxE,OAAO,CAAC0D,oBA5CuB,CAA3B,CAAP;;AA8CF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOI,SAAS,CAAC9B,IAAV,EAAP;AAlDJ;AAoDD;AACF,SAvDM,EAuDJ4B,QAvDI,EAuDM,IAvDN,CAAP;AAwDD,OAzD4D,CAA9C,CAAf;;AA2DA,eAASuB,OAAT,GAAmB;AACjB,eAAOxB,QAAQ,CAACxB,KAAT,CAAe,IAAf,EAAqB/B,SAArB,CAAP;AACD;;AAED,aAAO+E,OAAP;AACD,KAjEM;AAFN,GAnImC,EAuMnC;AACDzE,IAAAA,GAAG,EAAE,YADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI+F,WAAW,GAAG,CAAC,GAAG5F,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASyE,QAAT,GAAoB;AAC5G,eAAO9F,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASuE,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACrE,IAAV,GAAiBqE,SAAS,CAACpE,IAAnC;AACE,mBAAK,CAAL;AACE,uBAAOoE,SAAS,CAAC3D,MAAV,CAAiB,QAAjB,EAA2B,KAAK1B,SAAL,CAAe6D,IAAf,CAAoB,IAApB,EAA0B,IAA1B,EAAgC,CAAhC,EAAmC,CAAnC,EAAsChB,MAAM,CAACC,IAAP,CAAY,EAAZ,CAAtC,EAAuD,CAAChD,OAAO,CAACwB,UAAR,CAAmBC,OAApB,EAA6B,MAA7B,CAAvD,EAA6FuC,IAA7F,CAAkG,UAAUC,QAAV,EAAoB;AACtJ,sBAAIC,aAAa,GAAGD,QAAQ,CAACf,KAAT,CAAe,CAAC,CAAhB,CAApB;AACA,sBAAIiB,UAAU,GAAGD,aAAa,CAAC,CAAD,CAAb,GAAmB,GAAnB,GAAyBA,aAAa,CAAC,CAAD,CAAvD;;AAEA,sBAAIC,UAAU,KAAK,MAAnB,EAA2B;AACzB,2BAAO;AACL5C,sBAAAA,WAAW,EAAE4C,UADR;AAELpC,sBAAAA,aAAa,EAAE;AAFV,qBAAP;AAID;;AAED,sBAAIyD,QAAQ,GAAGvB,QAAQ,CAACf,KAAT,CAAe,CAAf,EAAkB,CAAlB,EAAqBwB,QAArB,CAA8B,KAA9B,CAAf;AACA,sBAAIe,GAAG,GAAG,CAAV;AACA,sBAAIC,uBAAuB,GAAGzB,QAAQ,CAACwB,GAAD,CAAtC;AACAA,kBAAAA,GAAG,IAAI,CAAP;AACA,sBAAIE,SAAS,GAAG1B,QAAQ,CAACf,KAAT,CAAeuC,GAAf,EAAoBA,GAAG,GAAGC,uBAA1B,EAAmDhB,QAAnD,EAAhB;AACAe,kBAAAA,GAAG,IAAIC,uBAAP;AACA,sBAAIE,QAAQ,GAAG3B,QAAQ,CAACwB,GAAD,CAAvB;AACAA,kBAAAA,GAAG,IAAI,CAAP;AACA,sBAAII,IAAI,GAAG5B,QAAQ,CAACf,KAAT,CAAeuC,GAAf,EAAoBA,GAAG,GAAGG,QAA1B,EAAoClB,QAApC,CAA6C,KAA7C,CAAX;AACAe,kBAAAA,GAAG,IAAIG,QAAP;AACA,sBAAIE,aAAa,GAAG7B,QAAQ,CAACwB,GAAD,CAA5B;AACAA,kBAAAA,GAAG,IAAI,CAAP,CAtBsJ,CAsB5I;;AAEV,sBAAIM,GAAG,GAAG9B,QAAQ,CAACf,KAAT,CAAeuC,GAAf,EAAoBA,GAAG,GAAGK,aAA1B,CAAV;;AAEA,sBAAIC,GAAG,CAACD,aAAa,GAAG,CAAjB,CAAH,KAA2B,CAA/B,EAAkC;AAChCC,oBAAAA,GAAG,GAAG9B,QAAQ,CAACf,KAAT,CAAeuC,GAAf,EAAoBA,GAAG,GAAGK,aAAN,GAAsB,CAA1C,CAAN;AACD;;AAED,sBAAIE,UAAU,GAAGD,GAAG,CAACrB,QAAJ,EAAjB;AACA,yBAAO;AACLnD,oBAAAA,WAAW,EAAE4C,UADR;AAELpC,oBAAAA,aAAa,EAAE,CAAC,GAAG/B,OAAO,CAAC8E,iBAAZ,EAA+BX,UAA/B,CAFV;AAGL;AACAqB,oBAAAA,QAAQ,EAAEA,QAJL;AAKLG,oBAAAA,SAAS,EAAEA,SALN;AAMLE,oBAAAA,IAAI,EAAEA,IAND;AAOLG,oBAAAA,UAAU,EAAEA;AAPP,mBAAP;AASD,iBAxCiC,EAwC/BhG,OAAO,CAAC0D,oBAxCuB,CAA3B,CAAP;;AA0CF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAO6B,SAAS,CAACvD,IAAV,EAAP;AA9CJ;AAgDD;AACF,SAnDM,EAmDJqD,QAnDI,EAmDM,IAnDN,CAAP;AAoDD,OArD+D,CAA9C,CAAlB;;AAuDA,eAASY,UAAT,GAAsB;AACpB,eAAOb,WAAW,CAACjD,KAAZ,CAAkB,IAAlB,EAAwB/B,SAAxB,CAAP;AACD;;AAED,aAAO6F,UAAP;AACD,KA7DM;AAFN,GAvMmC,EAuQnC;AACDvF,IAAAA,GAAG,EAAE,WADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI6G,UAAU,GAAG,CAAC,GAAG1G,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASuF,QAAT,CAAkBrF,IAAlB,EAAwB;AAC/G,YAAIyB,cAAJ,EAAoB6D,IAApB;AACA,eAAO7G,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASsF,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACpF,IAAV,GAAiBoF,SAAS,CAACnF,IAAnC;AACE,mBAAK,CAAL;AACEmF,gBAAAA,SAAS,CAACpF,IAAV,GAAiB,CAAjB;AACAoF,gBAAAA,SAAS,CAACnF,IAAV,GAAiB,CAAjB;AACA,uBAAO,KAAKc,aAAL,CAAmBnB,IAAnB,CAAP;;AAEF,mBAAK,CAAL;AACEyB,gBAAAA,cAAc,GAAG+D,SAAS,CAAChF,IAA3B;AACAgF,gBAAAA,SAAS,CAAC5E,EAAV,GAAe,KAAKL,eAAL,CAAqBM,KAApC;AACA2E,gBAAAA,SAAS,CAACnF,IAAV,GAAiBmF,SAAS,CAAC5E,EAAV,KAAiB,CAAjB,GAAqB,CAArB,GAAyB4E,SAAS,CAAC5E,EAAV,KAAiB,CAAjB,GAAqB,CAArB,GAAyB,EAAnE;AACA;;AAEF,mBAAK,CAAL;AACE,uBAAO4E,SAAS,CAAC1E,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG9B,QAAQ,CAACyG,WAAb,EAA0B,IAA1B,EAAgChE,cAAhC,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACE6D,gBAAAA,IAAI,GAAGrD,MAAM,CAACyD,MAAP,CAAc,CAACvG,SAAS,CAACwG,YAAV,CAAuB,QAAvB,CAAD,EAAmClE,cAAnC,CAAd,CAAP;AACA,uBAAO+D,SAAS,CAAC1E,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG7B,SAAS,CAAC2G,WAAd,EAA2B,IAA3B,EAAiCN,IAAjC,CAA3B,CAAP;;AAEF,mBAAK,EAAL;AACE,uBAAOE,SAAS,CAAC1E,MAAV,CAAiB,QAAjB,EAA2B;AAChCL,kBAAAA,WAAW,EAAE,MADmB;AAEhCQ,kBAAAA,aAAa,EAAE;AAFiB,iBAA3B,CAAP;;AAKF,mBAAK,EAAL;AACEuE,gBAAAA,SAAS,CAACnF,IAAV,GAAiB,EAAjB;AACA;;AAEF,mBAAK,EAAL;AACEmF,gBAAAA,SAAS,CAACpF,IAAV,GAAiB,EAAjB;AACAoF,gBAAAA,SAAS,CAACK,EAAV,GAAeL,SAAS,CAAC,OAAD,CAAT,CAAmB,CAAnB,CAAf;AACA,uBAAOA,SAAS,CAAC1E,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG5B,OAAO,CAAC0D,oBAAZ,EAAkC4C,SAAS,CAACK,EAA5C,CAA3B,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOL,SAAS,CAACtE,IAAV,EAAP;AApCJ;AAsCD;AACF,SAzCM,EAyCJmE,QAzCI,EAyCM,IAzCN,EAyCY,CAAC,CAAC,CAAD,EAAI,EAAJ,CAAD,CAzCZ,CAAP;AA0CD,OA5C8D,CAA9C,CAAjB;;AA8CA,eAASS,SAAT,CAAmBC,GAAnB,EAAwB;AACtB,eAAOX,UAAU,CAAC/D,KAAX,CAAiB,IAAjB,EAAuB/B,SAAvB,CAAP;AACD;;AAED,aAAOwG,SAAP;AACD,KApDM;AAFN,GAvQmC,EA8TnC;AACDlG,IAAAA,GAAG,EAAE,qBADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIyH,oBAAoB,GAAG,CAAC,GAAGtH,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASmG,QAAT,CAAkBjG,IAAlB,EAAwBkG,GAAxB,EAA6B;AAC9H,YAAIC,KAAK,GAAG,IAAZ;;AAEA,eAAO1H,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASmG,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACjG,IAAV,GAAiBiG,SAAS,CAAChG,IAAnC;AACE,mBAAK,CAAL;AACEgG,gBAAAA,SAAS,CAACjG,IAAV,GAAiB,CAAjB;AACA,uBAAOiG,SAAS,CAACvF,MAAV,CAAiB,QAAjB,EAA2B,KAAKK,aAAL,CAAmBnB,IAAnB,EAAyBkD,IAAzB,CAA8B,UAAUzB,cAAV,EAA0B;AACxF,sBAAI6D,IAAI,GAAGrD,MAAM,CAACyD,MAAP,CAAc,CAACvG,SAAS,CAACwG,YAAV,CAAuBO,GAAvB,CAAD,EAA8BzE,cAA9B,CAAd,CAAX;AACA,yBAAO0E,KAAK,CAAC/G,SAAN,CAAgB6D,IAAhB,CAAqB/D,OAAO,CAACoH,GAA7B,EAAkCpH,OAAO,CAACqH,GAAR,CAAYC,kBAA9C,EAAkEtH,OAAO,CAACuH,SAAR,CAAkBC,aAApF,EAAmG,CAAnG,EAAsGpB,IAAtG,EAA4G,CAACpG,OAAO,CAACwB,UAAR,CAAmBC,OAApB,CAA5G,EAA0IuC,IAA1I,CAA+I,UAAUC,QAAV,EAAoB;AACxK,wBAAIC,aAAa,GAAGD,QAAQ,CAACf,KAAT,CAAe,CAAC,CAAhB,CAApB;AACA,wBAAIiB,UAAU,GAAGD,aAAa,CAAC,CAAD,CAAb,GAAmB,GAAnB,GAAyBA,aAAa,CAAC,CAAD,CAAvD;AACA,wBAAIuD,YAAY,GAAG1E,MAAM,CAACC,IAAP,CAAYiB,QAAQ,CAACf,KAAT,CAAe,CAAf,EAAkB,EAAlB,CAAZ,CAAnB;AACA,wBAAIwE,aAAa,GAAG3E,MAAM,CAACC,IAAP,CAAYiB,QAAQ,CAACf,KAAT,CAAe,EAAf,EAAmB,CAAC,CAApB,CAAZ,EAAoCwB,QAApC,EAApB;AACA,2BAAO;AACLiD,sBAAAA,cAAc,EAAED,aADX;AAELE,sBAAAA,aAAa,EAAEH,YAFV;AAGLlG,sBAAAA,WAAW,EAAE4C,UAHR;AAILpC,sBAAAA,aAAa,EAAE,CAAC,GAAG/B,OAAO,CAAC8E,iBAAZ,EAA+BX,UAA/B;AAJV,qBAAP;AAMD,mBAXM,EAWJnE,OAAO,CAAC0D,oBAXJ,CAAP;AAYD,iBAdiC,EAc/BmE,KAd+B,CAczB,UAAUC,GAAV,EAAe;AACtB,yBAAO,CAAC,GAAG9H,OAAO,CAAC0D,oBAAZ,EAAkCoE,GAAlC,CAAP;AACD,iBAhBiC,CAA3B,CAAP;;AAkBF,mBAAK,CAAL;AACEX,gBAAAA,SAAS,CAACjG,IAAV,GAAiB,CAAjB;AACAiG,gBAAAA,SAAS,CAACzF,EAAV,GAAeyF,SAAS,CAAC,OAAD,CAAT,CAAmB,CAAnB,CAAf;AACA,uBAAOA,SAAS,CAACvF,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG5B,OAAO,CAAC0D,oBAAZ,EAAkCyD,SAAS,CAACzF,EAA5C,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOyF,SAAS,CAACnF,IAAV,EAAP;AA5BJ;AA8BD;AACF,SAjCM,EAiCJ+E,QAjCI,EAiCM,IAjCN,EAiCY,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,CAjCZ,CAAP;AAkCD,OArCwE,CAA9C,CAA3B;;AAuCA,eAASgB,mBAAT,CAA6BC,GAA7B,EAAkCC,GAAlC,EAAuC;AACrC,eAAOnB,oBAAoB,CAAC3E,KAArB,CAA2B,IAA3B,EAAiC/B,SAAjC,CAAP;AACD;;AAED,aAAO2H,mBAAP;AACD,KA7CM;AAFN,GA9TmC,EA8WnC;AACDrH,IAAAA,GAAG,EAAE,sBADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI6I,qBAAqB,GAAG,CAAC,GAAG1I,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASuH,QAAT,CAAkBrH,IAAlB,EAAwBkG,GAAxB,EAA6B;AAC/H,YAAIoB,MAAM,GAAG,IAAb;;AAEA,eAAO7I,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASsH,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACpH,IAAV,GAAiBoH,SAAS,CAACnH,IAAnC;AACE,mBAAK,CAAL;AACEmH,gBAAAA,SAAS,CAACpH,IAAV,GAAiB,CAAjB;AACA,uBAAOoH,SAAS,CAAC1G,MAAV,CAAiB,QAAjB,EAA2B,KAAKK,aAAL,CAAmBnB,IAAnB,EAAyBkD,IAAzB,CAA8B,UAAUzB,cAAV,EAA0B;AACxF,sBAAI6D,IAAI,GAAGrD,MAAM,CAACyD,MAAP,CAAc,CAACvG,SAAS,CAACwG,YAAV,CAAuBO,GAAvB,CAAD,EAA8BzE,cAA9B,CAAd,CAAX;AACA,yBAAO6F,MAAM,CAAClI,SAAP,CAAiB6D,IAAjB,CAAsB/D,OAAO,CAACoH,GAA9B,EAAmCpH,OAAO,CAACqH,GAAR,CAAYC,kBAA/C,EAAmEtH,OAAO,CAACuH,SAAR,CAAkBgB,sBAArF,EAA6G,CAA7G,EAAgHnC,IAAhH,EAAsH,CAACpG,OAAO,CAACwB,UAAR,CAAmBC,OAApB,CAAtH,EAAoJuC,IAApJ,CAAyJ,UAAUC,QAAV,EAAoB;AAClL,wBAAIC,aAAa,GAAGD,QAAQ,CAACf,KAAT,CAAe,CAAC,CAAhB,CAApB;AACA,wBAAIiB,UAAU,GAAGD,aAAa,CAAC,CAAD,CAAb,GAAmB,GAAnB,GAAyBA,aAAa,CAAC,CAAD,CAAvD;AACA,wBAAIuD,YAAY,GAAG1E,MAAM,CAACC,IAAP,CAAYiB,QAAQ,CAACf,KAAT,CAAe,CAAf,EAAkB,EAAlB,CAAZ,CAAnB;AACA,wBAAIwE,aAAa,GAAG3E,MAAM,CAACC,IAAP,CAAYiB,QAAQ,CAACf,KAAT,CAAe,EAAf,EAAmB,CAAC,CAApB,CAAZ,EAAoCwB,QAApC,EAApB;AACA,2BAAO;AACLiD,sBAAAA,cAAc,EAAED,aADX;AAELE,sBAAAA,aAAa,EAAEH,YAFV;AAGLlG,sBAAAA,WAAW,EAAE4C,UAHR;AAILpC,sBAAAA,aAAa,EAAE,CAAC,GAAG/B,OAAO,CAAC8E,iBAAZ,EAA+BX,UAA/B;AAJV,qBAAP;AAMD,mBAXM,EAWJnE,OAAO,CAAC0D,oBAXJ,CAAP;AAYD,iBAdiC,EAc/BmE,KAd+B,CAczB,UAAUC,GAAV,EAAe;AACtB,yBAAO,CAAC,GAAG9H,OAAO,CAAC0D,oBAAZ,EAAkCoE,GAAlC,CAAP;AACD,iBAhBiC,CAA3B,CAAP;;AAkBF,mBAAK,CAAL;AACEQ,gBAAAA,SAAS,CAACpH,IAAV,GAAiB,CAAjB;AACAoH,gBAAAA,SAAS,CAAC5G,EAAV,GAAe4G,SAAS,CAAC,OAAD,CAAT,CAAmB,CAAnB,CAAf;AACA,uBAAOA,SAAS,CAAC1G,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG5B,OAAO,CAAC0D,oBAAZ,EAAkC4E,SAAS,CAAC5G,EAA5C,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAO4G,SAAS,CAACtG,IAAV,EAAP;AA5BJ;AA8BD;AACF,SAjCM,EAiCJmG,QAjCI,EAiCM,IAjCN,EAiCY,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,CAjCZ,CAAP;AAkCD,OArCyE,CAA9C,CAA5B;;AAuCA,eAASK,oBAAT,CAA8BC,GAA9B,EAAmCC,GAAnC,EAAwC;AACtC,eAAOR,qBAAqB,CAAC/F,KAAtB,CAA4B,IAA5B,EAAkC/B,SAAlC,CAAP;AACD;;AAED,aAAOoI,oBAAP;AACD,KA7CM;AAFN,GA9WmC,EA8ZnC;AACD9H,IAAAA,GAAG,EAAE,eADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIsJ,cAAc,GAAG,CAAC,GAAGnJ,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASgI,QAAT,CAAkBC,QAAlB,EAA4BC,QAA5B,EAAsCC,KAAtC,EAA6C;AACxI,eAAOxJ,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASiI,SAAT,CAAmBC,SAAnB,EAA8B;AAC7D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAAC/H,IAAV,GAAiB+H,SAAS,CAAC9H,IAAnC;AACE,mBAAK,CAAL;AACE8H,gBAAAA,SAAS,CAACvH,EAAV,GAAe,KAAKL,eAAL,CAAqBM,KAApC;AACAsH,gBAAAA,SAAS,CAAC9H,IAAV,GAAiB8H,SAAS,CAACvH,EAAV,KAAiB,CAAjB,GAAqB,CAArB,GAAyBuH,SAAS,CAACvH,EAAV,KAAiB,CAAjB,GAAqB,CAArB,GAAyB,CAAnE;AACA;;AAEF,mBAAK,CAAL;AACE,uBAAOuH,SAAS,CAACrH,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG9B,QAAQ,CAACoJ,eAAb,EAA8B,IAA9B,EAAoCL,QAApC,EAA8CC,QAA9C,EAAwDC,KAAxD,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACE,uBAAOE,SAAS,CAACrH,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAG7B,SAAS,CAACoJ,eAAd,EAA+B,IAA/B,EAAqCN,QAArC,EAA+CC,QAA/C,EAAyDC,KAAzD,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACE,uBAAOE,SAAS,CAACrH,MAAV,CAAiB,QAAjB,EAA2B;AAChCL,kBAAAA,WAAW,EAAE,MADmB;AAEhCQ,kBAAAA,aAAa,EAAE;AAFiB,iBAA3B,CAAP;;AAKF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOkH,SAAS,CAACjH,IAAV,EAAP;AApBJ;AAsBD;AACF,SAzBM,EAyBJ4G,QAzBI,EAyBM,IAzBN,CAAP;AA0BD,OA3BkE,CAA9C,CAArB;;AA6BA,eAASQ,aAAT,CAAuBC,GAAvB,EAA4BC,IAA5B,EAAkCC,IAAlC,EAAwC;AACtC,eAAOZ,cAAc,CAACxG,KAAf,CAAqB,IAArB,EAA2B/B,SAA3B,CAAP;AACD;;AAED,aAAOgJ,aAAP;AACD,KAnCM;AAFN,GA9ZmC,EAocnC;AACD1I,IAAAA,GAAG,EAAE,MADJ;AAEDrB,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAImK,KAAK,GAAG,CAAC,GAAGhK,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAAS6I,SAAT,CAAmB3I,IAAnB,EAAyBwB,OAAzB,EAAkC;AACpH,YAAIoH,MAAM,GAAG,IAAb;;AAEA,eAAOnK,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAAS4I,UAAT,CAAoBC,UAApB,EAAgC;AAC/D,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC1I,IAAX,GAAkB0I,UAAU,CAACzI,IAArC;AACE,mBAAK,CAAL;AACE,uBAAOyI,UAAU,CAAChI,MAAX,CAAkB,QAAlB,EAA4B,KAAKuB,aAAL,CAAmBrC,IAAnB,EAAyBwB,OAAzB,EAAkC0B,IAAlC,CAAuC,UAAUxB,MAAV,EAAkB;AAC1F,yBAAOkH,MAAM,CAACN,aAAP,CAAqB,CAArB,EAAwB5G,MAAM,CAACnC,MAA/B,EAAuCmC,MAAM,CAAC,CAAD,CAA7C,EAAkD,CAACxC,OAAO,CAACwB,UAAR,CAAmBC,OAApB,CAAlD,EAAgFuC,IAAhF,EAAsF,aAAa,YAAY;AACpH,wBAAI6F,IAAI,GAAG,CAAC,GAAGrK,kBAAkB,CAACF,OAAvB,GAAiC,aAAaC,YAAY,CAACD,OAAb,CAAqBsB,IAArB,CAA0B,SAASkJ,SAAT,CAAmB7F,QAAnB,EAA6B;AAC9G,0BAAIG,MAAJ,EAAY1B,CAAZ;AACA,6BAAOnD,YAAY,CAACD,OAAb,CAAqByB,IAArB,CAA0B,SAASgJ,UAAT,CAAoBC,UAApB,EAAgC;AAC/D,+BAAO,CAAP,EAAU;AACR,kCAAQA,UAAU,CAAC9I,IAAX,GAAkB8I,UAAU,CAAC7I,IAArC;AACE,iCAAK,CAAL;AACEiD,8BAAAA,MAAM,GAAG;AACP7C,gCAAAA,WAAW,EAAE0C,QAAQ,CAAC1C,WADf;AAEPQ,gCAAAA,aAAa,EAAEkC,QAAQ,CAAClC,aAFjB;AAGPkI,gCAAAA,SAAS,EAAE;AAHJ,+BAAT;AAKAvH,8BAAAA,CAAC,GAAG,CAAJ;;AAEF,iCAAK,CAAL;AACE,kCAAI,EAAEA,CAAC,GAAGF,MAAM,CAACnC,MAAb,CAAJ,EAA0B;AACxB2J,gCAAAA,UAAU,CAAC7I,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED6I,8BAAAA,UAAU,CAAC7I,IAAX,GAAkB,CAAlB;AACA,qCAAOuI,MAAM,CAACN,aAAP,CAAqB,IAAI1G,CAAzB,EAA4BF,MAAM,CAACnC,MAAnC,EAA2CmC,MAAM,CAACE,CAAD,CAAjD,CAAP;;AAEF,iCAAK,CAAL;AACE0B,8BAAAA,MAAM,GAAG4F,UAAU,CAAC1I,IAApB;;AAEA,kCAAI,EAAE8C,MAAM,CAAC7C,WAAP,KAAuBvB,OAAO,CAACwB,UAAR,CAAmBC,OAA5C,CAAJ,EAA0D;AACxDuI,gCAAAA,UAAU,CAAC7I,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,qCAAO6I,UAAU,CAACpI,MAAX,CAAkB,OAAlB,EAA2B,EAA3B,CAAP;;AAEF,iCAAK,CAAL;AACEc,8BAAAA,CAAC,IAAI,CAAL;AACAsH,8BAAAA,UAAU,CAAC7I,IAAX,GAAkB,CAAlB;AACA;;AAEF,iCAAK,EAAL;AACE,qCAAO6I,UAAU,CAACpI,MAAX,CAAkB,QAAlB,EAA4B;AACjCL,gCAAAA,WAAW,EAAE6C,MAAM,CAAC7C,WADa;AAEjCQ,gCAAAA,aAAa,EAAEqC,MAAM,CAACrC,aAFW;AAGjC;AACAkI,gCAAAA,SAAS,EAAE7F,MAAM,CAAC6F;AAJe,+BAA5B,CAAP;;AAOF,iCAAK,EAAL;AACA,iCAAK,KAAL;AACE,qCAAOD,UAAU,CAAChI,IAAX,EAAP;AA3CJ;AA6CD;AACF,uBAhDM,EAgDJ8H,SAhDI,CAAP;AAiDD,qBAnDwD,CAA9C,CAAX;;AAqDA,2BAAO,UAAUI,IAAV,EAAgB;AACrB,6BAAOL,IAAI,CAAC1H,KAAL,CAAW,IAAX,EAAiB/B,SAAjB,CAAP;AACD,qBAFD;AAGD,mBAzDyG,EAAnG,EAyDFJ,OAAO,CAAC0D,oBAzDN,CAAP;AA0DD,iBA3DkC,EA2DhC1D,OAAO,CAAC0D,oBA3DwB,CAA5B,CAAP;;AA6DF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOkG,UAAU,CAAC5H,IAAX,EAAP;AAjEJ;AAmED;AACF,SAtEM,EAsEJyH,SAtEI,EAsEO,IAtEP,CAAP;AAuED,OA1EyD,CAA9C,CAAZ;;AA4EA,eAASU,IAAT,CAAcC,IAAd,EAAoBC,IAApB,EAA0B;AACxB,eAAOb,KAAK,CAACrH,KAAN,CAAY,IAAZ,EAAkB/B,SAAlB,CAAP;AACD;;AAED,aAAO+J,IAAP;AACD,KAlFM;AAFN,GApcmC,CAAtC,EAyhBI,CAAC;AACHzJ,IAAAA,GAAG,EAAE,cADF;AAEHrB,IAAAA,KAAK,EAAE,SAASoH,YAAT,CAAsBO,GAAtB,EAA2B;AAChC,UAAIA,GAAG,IAAI,IAAP,IAAeA,GAAG,CAAC3G,MAAJ,GAAa,CAA5B,IAAiC2G,GAAG,CAAC3G,MAAJ,GAAa,EAAlD,EAAsD;AACpD,cAAM,IAAIG,KAAJ,CAAU,aAAV,CAAN;AACD;;AAED,UAAI8J,GAAG,GAAGvH,MAAM,CAACwH,KAAP,CAAa,IAAIvD,GAAG,CAAC3G,MAArB,CAAV;AACAiK,MAAAA,GAAG,CAACE,UAAJ,CAAexD,GAAG,CAAC3G,MAAnB,EAA2B,CAA3B;AACAiK,MAAAA,GAAG,CAACG,KAAJ,CAAUzD,GAAV,EAAe,CAAf;AACA,aAAOsD,GAAP;AACD;AAXE,GAAD,EAYD;AACD5J,IAAAA,GAAG,EAAE,iBADJ;AAEDrB,IAAAA,KAAK,EAAE,SAASqL,eAAT,CAAyB1D,GAAzB,EAA8B2D,EAA9B,EAAkC;AACvC,UAAIA,EAAE,CAACtK,MAAH,KAAc,EAAlB,EAAsB;AACpB,cAAM,IAAIG,KAAJ,CAAU,2CAAV,CAAN;AACD;;AAED,UAAIoK,UAAU,GAAGjL,OAAO,CAACL,OAAR,CAAgBuL,UAAhB,CAA2B,QAA3B,EAAqCC,MAArC,CAA4CH,EAA5C,EAAgDI,MAAhD,EAAjB;;AAEA,UAAIC,OAAO,GAAG,IAAIpL,OAAO,CAACN,OAAZ,GAAsBwL,MAAtB,CAA6BF,UAA7B,EAAyCG,MAAzC,EAAd;AACA,aAAOlL,KAAK,CAACP,OAAN,CAAc2L,MAAd,CAAqBjE,GAArB,EAA0BnH,KAAK,CAACP,OAAN,CAAc4L,OAAd,CAAsBF,OAAtB,CAA1B,CAAP;AACD;AAXA,GAZC,CAzhBJ;AAkjBA,SAAO/K,SAAP;AACD,CAhkB4B,EAA7B;;AAkkBAb,OAAO,CAACE,OAAR,GAAkBW,SAAlB","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nvar _ripemd = _interopRequireDefault(require(\"ripemd160\"));\n\nvar _bech = _interopRequireDefault(require(\"bech32\"));\n\nvar _helperV = require(\"./helperV1\");\n\nvar _helperV2 = require(\"./helperV2\");\n\nvar _common = require(\"./common\");\n\n/** ******************************************************************************\n *  (c) 2019 ZondaX GmbH\n *  (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ******************************************************************************* */\nvar CosmosApp = /*#__PURE__*/function () {\n  function CosmosApp(transport) {\n    var scrambleKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _common.APP_KEY;\n    (0, _classCallCheck2.default)(this, CosmosApp);\n\n    if (!transport) {\n      throw new Error(\"Transport has not been defined\");\n    }\n\n    this.transport = transport;\n    transport.decorateAppAPIMethods(this, [\"getVersion\", \"sign\", \"getAddressAndPubKey\", \"appInfo\", \"deviceInfo\", \"getBech32FromPK\"], scrambleKey);\n  }\n\n  (0, _createClass2.default)(CosmosApp, [{\n    key: \"serializePath\",\n    value: function () {\n      var _serializePath = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(path) {\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return (0, _common.getVersion)(this.transport);\n\n              case 2:\n                this.versionResponse = _context.sent;\n\n                if (!(this.versionResponse.return_code !== _common.ERROR_CODE.NoError)) {\n                  _context.next = 5;\n                  break;\n                }\n\n                throw this.versionResponse;\n\n              case 5:\n                _context.t0 = this.versionResponse.major;\n                _context.next = _context.t0 === 1 ? 8 : _context.t0 === 2 ? 9 : 10;\n                break;\n\n              case 8:\n                return _context.abrupt(\"return\", (0, _helperV.serializePathv1)(path));\n\n              case 9:\n                return _context.abrupt(\"return\", (0, _helperV2.serializePathv2)(path));\n\n              case 10:\n                return _context.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function serializePath(_x) {\n        return _serializePath.apply(this, arguments);\n      }\n\n      return serializePath;\n    }()\n  }, {\n    key: \"signGetChunks\",\n    value: function () {\n      var _signGetChunks = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(path, message) {\n        var serializedPath, chunks, buffer, i, end;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.serializePath(path);\n\n              case 2:\n                serializedPath = _context2.sent;\n                chunks = [];\n                chunks.push(serializedPath);\n                buffer = Buffer.from(message);\n\n                for (i = 0; i < buffer.length; i += _common.CHUNK_SIZE) {\n                  end = i + _common.CHUNK_SIZE;\n\n                  if (i > buffer.length) {\n                    end = buffer.length;\n                  }\n\n                  chunks.push(buffer.slice(i, end));\n                }\n\n                return _context2.abrupt(\"return\", chunks);\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function signGetChunks(_x2, _x3) {\n        return _signGetChunks.apply(this, arguments);\n      }\n\n      return signGetChunks;\n    }()\n  }, {\n    key: \"getVersion\",\n    value: function () {\n      var _getVersion2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return (0, _common.getVersion)(this.transport);\n\n              case 3:\n                this.versionResponse = _context3.sent;\n                return _context3.abrupt(\"return\", this.versionResponse);\n\n              case 7:\n                _context3.prev = 7;\n                _context3.t0 = _context3[\"catch\"](0);\n                return _context3.abrupt(\"return\", (0, _common.processErrorResponse)(_context3.t0));\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 7]]);\n      }));\n\n      function getVersion() {\n        return _getVersion2.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: \"appInfo\",\n    value: function () {\n      var _appInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4() {\n        return _regenerator.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this.transport.send(0xb0, 0x01, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var result = {};\n                  var appName = \"err\";\n                  var appVersion = \"err\";\n                  var flagLen = 0;\n                  var flagsValue = 0;\n\n                  if (response[0] !== 1) {\n                    // Ledger responds with format ID 1. There is no spec for any format != 1\n                    result.error_message = \"response format ID not recognized\";\n                    result.return_code = 0x9001;\n                  } else {\n                    var appNameLen = response[1];\n                    appName = response.slice(2, 2 + appNameLen).toString(\"ascii\");\n                    var idx = 2 + appNameLen;\n                    var appVersionLen = response[idx];\n                    idx += 1;\n                    appVersion = response.slice(idx, idx + appVersionLen).toString(\"ascii\");\n                    idx += appVersionLen;\n                    var appFlagsLen = response[idx];\n                    idx += 1;\n                    flagLen = appFlagsLen;\n                    flagsValue = response[idx];\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    appName: appName,\n                    appVersion: appVersion,\n                    flagLen: flagLen,\n                    flagsValue: flagsValue,\n                    // eslint-disable-next-line no-bitwise\n                    flag_recovery: (flagsValue & 1) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_signed_mcu_code: (flagsValue & 2) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_onboarded: (flagsValue & 4) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_pin_validated: (flagsValue & 128) !== 0\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function appInfo() {\n        return _appInfo.apply(this, arguments);\n      }\n\n      return appInfo;\n    }()\n  }, {\n    key: \"deviceInfo\",\n    value: function () {\n      var _deviceInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n        return _regenerator.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt(\"return\", this.transport.send(0xe0, 0x01, 0, 0, Buffer.from([]), [_common.ERROR_CODE.NoError, 0x6e00]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n\n                  if (returnCode === 0x6e00) {\n                    return {\n                      return_code: returnCode,\n                      error_message: \"This command is only available in the Dashboard\"\n                    };\n                  }\n\n                  var targetId = response.slice(0, 4).toString(\"hex\");\n                  var pos = 4;\n                  var secureElementVersionLen = response[pos];\n                  pos += 1;\n                  var seVersion = response.slice(pos, pos + secureElementVersionLen).toString();\n                  pos += secureElementVersionLen;\n                  var flagsLen = response[pos];\n                  pos += 1;\n                  var flag = response.slice(pos, pos + flagsLen).toString(\"hex\");\n                  pos += flagsLen;\n                  var mcuVersionLen = response[pos];\n                  pos += 1; // Patch issue in mcu version\n\n                  var tmp = response.slice(pos, pos + mcuVersionLen);\n\n                  if (tmp[mcuVersionLen - 1] === 0) {\n                    tmp = response.slice(pos, pos + mcuVersionLen - 1);\n                  }\n\n                  var mcuVersion = tmp.toString();\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    targetId: targetId,\n                    seVersion: seVersion,\n                    flag: flag,\n                    mcuVersion: mcuVersion\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function deviceInfo() {\n        return _deviceInfo.apply(this, arguments);\n      }\n\n      return deviceInfo;\n    }()\n  }, {\n    key: \"publicKey\",\n    value: function () {\n      var _publicKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(path) {\n        var serializedPath, data;\n        return _regenerator.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return this.serializePath(path);\n\n              case 3:\n                serializedPath = _context6.sent;\n                _context6.t0 = this.versionResponse.major;\n                _context6.next = _context6.t0 === 1 ? 7 : _context6.t0 === 2 ? 8 : 10;\n                break;\n\n              case 7:\n                return _context6.abrupt(\"return\", (0, _helperV.publicKeyv1)(this, serializedPath));\n\n              case 8:\n                data = Buffer.concat([CosmosApp.serializeHRP(\"cosmos\"), serializedPath]);\n                return _context6.abrupt(\"return\", (0, _helperV2.publicKeyv2)(this, data));\n\n              case 10:\n                return _context6.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 11:\n                _context6.next = 16;\n                break;\n\n              case 13:\n                _context6.prev = 13;\n                _context6.t1 = _context6[\"catch\"](0);\n                return _context6.abrupt(\"return\", (0, _common.processErrorResponse)(_context6.t1));\n\n              case 16:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 13]]);\n      }));\n\n      function publicKey(_x4) {\n        return _publicKey.apply(this, arguments);\n      }\n\n      return publicKey;\n    }()\n  }, {\n    key: \"getAddressAndPubKey\",\n    value: function () {\n      var _getAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7(path, hrp) {\n        var _this = this;\n\n        return _regenerator.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.prev = 0;\n                return _context7.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.ONLY_RETRIEVE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n\n              case 4:\n                _context7.prev = 4;\n                _context7.t0 = _context7[\"catch\"](0);\n                return _context7.abrupt(\"return\", (0, _common.processErrorResponse)(_context7.t0));\n\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this, [[0, 4]]);\n      }));\n\n      function getAddressAndPubKey(_x5, _x6) {\n        return _getAddressAndPubKey.apply(this, arguments);\n      }\n\n      return getAddressAndPubKey;\n    }()\n  }, {\n    key: \"showAddressAndPubKey\",\n    value: function () {\n      var _showAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8(path, hrp) {\n        var _this2 = this;\n\n        return _regenerator.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.prev = 0;\n                return _context8.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this2.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.SHOW_ADDRESS_IN_DEVICE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n\n              case 4:\n                _context8.prev = 4;\n                _context8.t0 = _context8[\"catch\"](0);\n                return _context8.abrupt(\"return\", (0, _common.processErrorResponse)(_context8.t0));\n\n              case 7:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[0, 4]]);\n      }));\n\n      function showAddressAndPubKey(_x7, _x8) {\n        return _showAddressAndPubKey.apply(this, arguments);\n      }\n\n      return showAddressAndPubKey;\n    }()\n  }, {\n    key: \"signSendChunk\",\n    value: function () {\n      var _signSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee9(chunkIdx, chunkNum, chunk) {\n        return _regenerator.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.t0 = this.versionResponse.major;\n                _context9.next = _context9.t0 === 1 ? 3 : _context9.t0 === 2 ? 4 : 5;\n                break;\n\n              case 3:\n                return _context9.abrupt(\"return\", (0, _helperV.signSendChunkv1)(this, chunkIdx, chunkNum, chunk));\n\n              case 4:\n                return _context9.abrupt(\"return\", (0, _helperV2.signSendChunkv2)(this, chunkIdx, chunkNum, chunk));\n\n              case 5:\n                return _context9.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 6:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function signSendChunk(_x9, _x10, _x11) {\n        return _signSendChunk.apply(this, arguments);\n      }\n\n      return signSendChunk;\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee11(path, message) {\n        var _this3 = this;\n\n        return _regenerator.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                return _context11.abrupt(\"return\", this.signGetChunks(path, message).then(function (chunks) {\n                  return _this3.signSendChunk(1, chunks.length, chunks[0], [_common.ERROR_CODE.NoError]).then( /*#__PURE__*/function () {\n                    var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee10(response) {\n                      var result, i;\n                      return _regenerator.default.wrap(function _callee10$(_context10) {\n                        while (1) {\n                          switch (_context10.prev = _context10.next) {\n                            case 0:\n                              result = {\n                                return_code: response.return_code,\n                                error_message: response.error_message,\n                                signature: null\n                              };\n                              i = 1;\n\n                            case 2:\n                              if (!(i < chunks.length)) {\n                                _context10.next = 11;\n                                break;\n                              }\n\n                              _context10.next = 5;\n                              return _this3.signSendChunk(1 + i, chunks.length, chunks[i]);\n\n                            case 5:\n                              result = _context10.sent;\n\n                              if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                                _context10.next = 8;\n                                break;\n                              }\n\n                              return _context10.abrupt(\"break\", 11);\n\n                            case 8:\n                              i += 1;\n                              _context10.next = 2;\n                              break;\n\n                            case 11:\n                              return _context10.abrupt(\"return\", {\n                                return_code: result.return_code,\n                                error_message: result.error_message,\n                                // ///\n                                signature: result.signature\n                              });\n\n                            case 12:\n                            case \"end\":\n                              return _context10.stop();\n                          }\n                        }\n                      }, _callee10);\n                    }));\n\n                    return function (_x14) {\n                      return _ref.apply(this, arguments);\n                    };\n                  }(), _common.processErrorResponse);\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function sign(_x12, _x13) {\n        return _sign.apply(this, arguments);\n      }\n\n      return sign;\n    }()\n  }], [{\n    key: \"serializeHRP\",\n    value: function serializeHRP(hrp) {\n      if (hrp == null || hrp.length < 3 || hrp.length > 83) {\n        throw new Error(\"Invalid HRP\");\n      }\n\n      var buf = Buffer.alloc(1 + hrp.length);\n      buf.writeUInt8(hrp.length, 0);\n      buf.write(hrp, 1);\n      return buf;\n    }\n  }, {\n    key: \"getBech32FromPK\",\n    value: function getBech32FromPK(hrp, pk) {\n      if (pk.length !== 33) {\n        throw new Error(\"expected compressed public key [31 bytes]\");\n      }\n\n      var hashSha256 = _crypto.default.createHash(\"sha256\").update(pk).digest();\n\n      var hashRip = new _ripemd.default().update(hashSha256).digest();\n      return _bech.default.encode(hrp, _bech.default.toWords(hashRip));\n    }\n  }]);\n  return CosmosApp;\n}();\n\nexports.default = CosmosApp;"]},"metadata":{},"sourceType":"script"}